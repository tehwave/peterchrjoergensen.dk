---
/**
 * Individual project display card.
 *
 * Conditionally renders link with external icon when URL provided —
 * some projects are showcases without live links. Falls back to
 * letter placeholder when image unavailable (graceful degradation).
 */
import { Picture } from "astro:assets";
import type { ImageMetadata } from "astro";

interface Props {
  title: string;
  description: string;
  alt: string;
  tags?: string[];
  image?: ImageMetadata;
  link?: string;
  animationDelay?: number;
}

const { title, description, alt, tags = [], image, link } = Astro.props;

// "#" is used in data to indicate "no link yet" — treat as missing
const hasLink = link && link !== "#";
---

<article class="project-card">
  <div class="project-card__image-wrapper">
    {
      image ? (
        <Picture
          src={image}
          formats={["avif", "webp"]}
          alt={alt}
          class="project-card__image"
          loading="lazy"
          width={480}
          height={300}
          inferSize={true}
        />
      ) : (
        <div class="project-card__placeholder">
          <span>{title.charAt(0)}</span>
        </div>
      )
    }
  </div>
  <div class="project-card__content">
    <h3 class="project-card__title">
      {
        hasLink ? (
          <a
            href={link}
            target="_blank"
            rel="noopener noreferrer"
            class="project-card__link"
          >
            {title}
            <svg
              class="project-card__link-icon"
              width="14"
              height="14"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
            >
              <path d="M7 17L17 7M17 7H7M17 7V17" />
            </svg>
          </a>
        ) : (
          title
        )
      }
    </h3>
    <p class="project-card__description">{description}</p>
    {
      tags.length > 0 && (
        <div class="project-card__tags">
          {tags.map((tag) => (
            <span class="project-card__tag">{tag}</span>
          ))}
        </div>
      )
    }
  </div>
</article>

<style lang="scss">
  @use "sass:color";
  @use "../styles/variables" as *;
  @use "../styles/mixins" as *;

  .project-card {
    background-color: $color-white;
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 2px 8px $color-shadow;
    @include transition(all, 0.3s);
    display: flex;
    flex-direction: column;
    height: 100%;

    &:hover {
      transform: translateY(-4px);
      box-shadow: 0 8px 24px $color-shadow-hover;

      .project-card__image {
        transform: scale(1.05);
      }

      .project-card__placeholder {
        background: linear-gradient(
          135deg,
          color.adjust($color-blue, $lightness: 5%) 0%,
          $color-blue-dark 100%
        );
      }
    }

    &__image-wrapper {
      aspect-ratio: 16 / 10;
      overflow: hidden;
      background-color: $color-cream;
    }

    &__image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      @include transition(transform, 0.3s);
    }

    &__placeholder {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(
        135deg,
        $color-blue 0%,
        $color-blue-dark 100%
      );
      @include transition(background, 0.3s);

      span {
        font-size: $font-size-4xl;
        font-weight: 700;
        color: $color-white;
        opacity: 0.9;
        text-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
      }
    }

    &__content {
      padding: $space-xl;
      display: flex;
      flex-direction: column;
      gap: $space-sm;
      flex-grow: 1;
    }

    &__title {
      font-size: $font-size-lg;
      font-weight: 600;
      color: $color-text-dark;
    }

    &__link {
      color: inherit;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: $space-xs;
      border-radius: 4px;
      @include focus-visible;

      &:hover {
        color: $color-orange;
      }
    }

    &__link-icon {
      opacity: 0.6;
      @include transition(transform, 0.2s);

      .project-card__link:hover & {
        transform: translate(2px, -2px);
        opacity: 1;
      }
    }

    &__description {
      font-size: $font-size-sm;
      color: $color-text-muted;
      line-height: 1.6;
      flex-grow: 1;
    }

    &__tags {
      display: flex;
      flex-wrap: wrap;
      gap: $space-xs;
      margin-top: $space-sm;
    }

    &__tag {
      font-size: $font-size-xs;
      color: $color-text-muted;
      background-color: $color-blue-pale;
      padding: $space-xs $space-sm;
      border-radius: 4px;
    }
  }
</style>
